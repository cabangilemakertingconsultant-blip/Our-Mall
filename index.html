<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our-Mall | Marketplace</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { background:#111; color:#fff; font-family:'Segoe UI',sans-serif; padding:15px; }
h2 { text-align:center; color:#FFD700; margin-bottom:20px; }
.store-card { background:#1c1c1c; border:1px solid #FFD700; border-radius:10px; margin-bottom:20px; padding:10px; transition: transform .2s; }
.store-card:hover { transform: scale(1.02); }
.store-logo { max-height:100px; display:block; margin:0 auto 10px; }
.store-status { color:#0f0; font-weight:bold; text-align:center; display:block; }
.search-box { max-width:400px; margin:0 auto 20px; display:flex; justify-content:center; }
.search-box input { width:100%; padding:5px 10px; border-radius:5px; border:none; }
</style>
</head>
<body>

<h2>üõç Our-Mall Marketplace</h2>

<div class="search-box">
  <input id="storeSearchInput" placeholder="Search stores...">
</div>

<div class="row" id="storesContainer"></div>

<script>
const supabase = supabase.createClient('https://svfgtdqcklmbfyebqtcr.supabase.co', 'sb_publishable_a_-82NkD6MUkSGW1ZdPWMQ_fM9O0Sxl');
let allStores = [];

function getLicenseStatus(store){
  if(!store.license_start) return 'Trial';
  const now = new Date();
  const end = new Date(store.license_end);
  const graceEnd = new Date(end); graceEnd.setDate(graceEnd.getDate()+7);
  if(now<=end) return 'Active';
  if(now<=graceEnd) return 'Grace';
  return 'Expired';
}

async function loadStores(){
  const { data } = await supabase.from('stores').select('*').order('name');
  allStores = data||[];
  renderStores();
}

function renderStores(){
  const q = storeSearchInput.value.toLowerCase();
  storesContainer.innerHTML = allStores
    .filter(s=>['Active','Grace','Trial'].includes(getLicenseStatus(s)))
    .filter(s=>s.name.toLowerCase().includes(q))
    .map(s=>`
      <div class="col-md-4">
        <div class="store-card">
          ${s.logo?`<img src="${s.logo}" class="store-logo">`:''}
          <h5 class="text-center">${s.name}</h5>
          <span class="store-status">${getLicenseStatus(s)}</span>
          <a href="store.html?store=${s.id}" class="btn btn-warning w-100 mt-2">Visit Store</a>
        </div>
      </div>
    `).join('');
}

storeSearchInput.addEventListener('input', renderStores);
loadStores();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>